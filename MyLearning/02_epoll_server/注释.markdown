epoll学习笔记
// ==========================================
// 🪓 Epoll 第二板斧：给管家派活 (Ctl - Add)
// ==========================================
struct epoll_event event;
event.data.fd=listenfd;
event.events=EPOLLIN;

event.data.fd = listenfd//一开始建立socket的参数
	•	比喻：在便利贴上写下“这部电话是前台座机”。
	•	含义：关联身份。
	•	作用：因为 Epoll 管家只负责通知“有动静”，不负责记是谁。你必须把 listenfd 存进去。等事件发生时，管家会把这张便利贴原样还给你，你读取 data.fd 就能知道是哪个 Socket 有数据了。

event.events = EPOLLIN; //默认模式 (LT)
event.events =  EPOLLIN | EPOLLET; //高速模式 (ET)

//【Epoll 工作模式对比笔记：LT vs ET】
一、LT 模式 (Level Triggered - 水平触发)
1. 定义：
   Epoll 的【默认模式】。如果不加任何修饰，就是 LT。
2. 触发机制：
   只要内核缓冲区里【还有数据】，Epoll 就会【一直通知】你。
   （哪怕你上一次只读了一半，下一轮循环它还会催你读剩下的）
3. 优缺点：
   [+] 编程简单，不易丢数据（忘了读也没事，下次还会提醒）。
   [-] 效率稍低（没读完会重复触发中断，打扰 CPU）。
4. 适用场景：
   初学者入门、对并发要求不是极致变态高的场景。

二、ET 模式 (Edge Triggered - 边缘触发)
1. 定义：
   Epoll 的【高速模式】。TinyWebServer 等高性能服务器的核心。
2. 触发机制：
   只有当数据【从无到有】（即状态发生变化/边缘突变）的那一瞬间，Epoll 才通知【一次】。
   （如果你一次没读完，它【绝对不会】再通知第二次，剩下的数据就死锁在缓冲区里了）
3. 生活比喻 (高冷的老妈)：
   “饭做好了。” (只说一次)
   如果你只吃了一口就去玩了，她再也不会叫你。
   等你饿了想再吃，发现饭已经倒了（或者你根本不知道还有饭）。
4. 优缺点：
   [+] 效率极高（减少了内核重复通知的次数）。
   [-] 编程难度大（必须循环读取直到报错 EAGAIN，必须配合非阻塞 IO）。
5. 核心要求：
   必须一次性把数据读干净！(while 循环 recv)



// 把便签条贴到管家身上 (往内核事件表里添加)
 ret=epoll_ctl(epollfd,EPOLL_CTL_ADD,listenfd,&event);

一、函数原型与作用
作用
Epoll 的“控制中心”。负责管理监控名单（增、删、改）。
如果 epoll_create 是买本子，epoll_ctl 就是在本子上写字。

二、参数逐个解析
1. epollfd
   - epoll_create 返回的那个 ID。
   - 指定操作哪一个 Epoll 实例。

2. - 动作指令 (Operation)。三个可选宏定义：
     A. EPOLL_CTL_ADD (注册)：把 fd 加进去（最常用）。
     B. EPOLL_CTL_MOD (修改)：改监听事件（比如从“只读”改成“读写”）。
     C. EPOLL_CTL_DEL (删除)：把 fd 踢出名单（不再监控）。

3. - 目标文件描述符 (如 listenfd 或 connfd)。
   - 也就是你要监控的具体对象。

4. struct epoll_event *event (怎么记？)
   - 指向 epoll_event 结构体的指针（也就是那张便利贴）。
   - 内含 events (监听什么类型) 和 data (关联数据)。
   - 【重点】内核会【拷贝】一份这个结构体的数据存起来。
     (这意味着调用完函数后，外部的 event 变量可以被修改或重用，不会影响内核里已经存好的那份)。

三、底层原理 (面试加分项)
当调用 EPOLL_CTL_ADD 时，Linux 内核在底下做了什么？
- 数据结构：红黑树 (Red-Black Tree)。
- 动作：把你的 fd 作为一个节点，插入到内核维护的红黑树中。
- 优势：效率极高 (O(logN))。
  哪怕监控了 10 万个连接，想要增加、查找或删除一个 fd，速度都非常快，不会随连接数增加而显著变慢。

人话：“喂，管家(epfd)，给我添加(ADD)一个监控对象(listenfd)，具体的监控要求我都写在这个便签(&event)上了，照着做！”

// ==========================================
// 🪓 Epoll 第三板斧：坐等通知 (Wait)
// ==========================================

int number=epoll_wait(epollfd,events,1024,-1);
其实主要理解这个函数是一直执行，然后有“几件事”就返回 几

下面的基本上都懂☝️🤓


